var a=Object.defineProperty;var m=(o,e,n)=>e in o?a(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var s=(o,e,n)=>m(o,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();function c(o){document.getElementById("debug").innerText+=`
`+o}class u{constructor(e,n){s(this,"mqttclient");s(this,"address");s(this,"room_id");s(this,"client_id");this.address=e,this.client_id=""+Math.floor(Math.random()*1e6),this.room_id=n}requestPermission(){if(typeof DeviceMotionEvent>"u")return c("This device does not support Motion Events."),!1;if(typeof DeviceMotionEvent.requestPermission=="function")DeviceMotionEvent.requestPermission().then(e=>e==="granted").catch(console.error);else return c("DeviceMotionEvent requestPermission is not a function."),!1}startSensors(){const e=(t,i)=>{this.mqttclient.publish(`rooms/${this.room_id}/${this.client_id}/${t}`,i)},n=this.requestPermission();c("request permission: "+n),n&&(window.addEventListener("devicemotion",t=>{e("devicemotion",JSON.stringify({client_id:this.client_id,type:t.type,timestamp:t.timeStamp,x:t.acceleration.x,y:t.acceleration.y,z:t.acceleration.z,xg:t.accelerationIncludingGravity.x,yg:t.accelerationIncludingGravity.y,zg:t.accelerationIncludingGravity.z}))}),window.addEventListener("deviceorientation",t=>{e("deviceorientation",JSON.stringify({client_id:this.client_id,type:t.type,timestamp:t.timeStamp,alpha:t.alpha,beta:t.beta,gamma:t.gamma}))}))}connect(e=this.room_id){this.mqttclient&&this.mqttclient.end(),this.room_id=e;const n="rooms/"+e;c("Connecting to "+this.room_id),this.mqttclient=mqtt.connect(this.address),this.mqttclient.on("connect",()=>{this.mqttclient.subscribe(n+"/#",t=>{t||(this.startSensors(),this.mqttclient.publish(n,"Hello mqtt from "+this.client_id))})}),this.mqttclient.on("message",(t,i)=>{console.log(t,i.toString()),c(i.toString())})}}const f=window.location.search,h=new URLSearchParams(f),d=h.get("room");console.log(d);const g=new u("wss://mqtt.jaydoncheng.me:8084/mqtt",d);function p(o){document.getElementById("debug").innerText+=`
`+o}d&&(document.getElementById("roomId").innerText=`Room: ${d}`,document.getElementById("accelPermsButton").addEventListener("click",()=>{p("Hit connect"),g.connect(d)}));
